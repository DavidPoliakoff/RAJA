<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring and building the code &mdash; RAJA 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="RAJA 1.0.0 documentation" href="index.html" />
    <link rel="next" title="RAJA source code organization" href="code_organization.html" />
    <link rel="prev" title="Why RAJA?" href="why_raja.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="code_organization.html" title="RAJA source code organization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="why_raja.html" title="Why RAJA?"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RAJA 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuring-and-building-the-code">
<h1>Configuring and building the code<a class="headerlink" href="#configuring-and-building-the-code" title="Permalink to this headline">¶</a></h1>
<p>This section provides a brief discussion of how to configure and build
the RAJA code.</p>
<p>It is important to note that RAJA requires compiler support for lambda
functions and a few other C++11 features. Please make sure your compiler
is C++11-compliant before attempting to build RAJA.</p>
<div class="section" id="raja-cmake-system">
<h2>RAJA CMake System<a class="headerlink" href="#raja-cmake-system" title="Permalink to this headline">¶</a></h2>
<p>RAJA uses a simple CMake-based system, but you don&#8217;t need to know much
about CMake to build RAJA. It does require that you use a CMake version
greater than 3.1. If needed, you can learn more about CMake and download
it at <a class="reference external" href="http://www.cmake.org">http://www.cmake.org</a></p>
<p>An important thing to note is that our CMake setup does not allow
in-source builds so that you can easily configure and build for various
systems and compilers from the same source code.</p>
<p>Configuring the code can be done in a couple of ways depending on your needs.</p>
<p><strong>Use the provided configuration script.</strong></p>
<blockquote>
<div><p>If you have python installed on your system, you can execute a
python helper script from the root directory of the RAJA source code
to configure a build</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ./scripts/config-build.py
</pre></div>
</div>
<p>This script will find and use a configuration file to initialize the
CMake cache and create build and install directories in the RAJA root
directory whose names contain the system type, compiler, and built type.
For example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ls
build-chaos-gnu-debug
install-chaos-gnu-debug
</pre></div>
</div>
<p>The configuration files are located in the &#8216;host-config&#8217; directory.
The &#8216;host-configs&#8217; directory contains configuration files for platforms
and compilers most commonly used in the Livermore Computing Center at
Lawrence Livermore National Laboratory. The contents of these files and
how they are used in RAJA are described below. Note that new host
configuration cache files can be created by copying an existing one
to a new file and modifying the contents for your needs.</p>
<p>If you run the python script with no arguments, it will configure the
code using a default compiler and options for the platform you are on.
The script accepts several options for</p>
<blockquote>
<div><ul class="simple">
<li>specifying the build and install directory paths and names</li>
<li>specifying the compiler</li>
<li>specifying the build type (Release, Debug, RelWithDebInfo)</li>
<li>specifying CMake options</li>
<li>selecting the host configuration file to initialize the CMake cache</li>
</ul>
</div></blockquote>
<p>Script options can be displayed by running</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ./scripts/config-build.py --help
</pre></div>
</div>
</div></blockquote>
<p><strong>Run CMake directly.</strong></p>
<blockquote>
<div><p>You can also run CMake directly. To configure the code using this method,
create a build directory in the root directory and go into it</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ my-awesome-build
$ cd my-awesome-build
</pre></div>
</div>
<p>Then, you can invoke CMake without any arguments to pick a default
compiler on your platform based on your environment; e.g., on a linux
system, GNU is the default compiler choice</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ use gcc-4.9.3p
$ cmake ../
</pre></div>
</div>
<p>You can also invoke CMake directly and specify the build type and host-config
file you want; for example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cmake -DCMAKE_BUILD_TYPE=Debug -C ../host-configs/chaos/gnu_4_9_3.cmake ../
</pre></div>
</div>
</div></blockquote>
<p>Regardless of how you configure your build, you build the code by going into
the build directory and typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ make
</pre></div>
</div>
<p>If you want to also create an installation of the code, you can type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ make install
</pre></div>
</div>
<p>This will create &#8216;include&#8217; and &#8216;lib&#8217; directories in the install directory.</p>
<p><strong>LLNL platform-specific build information.</strong></p>
<p>We are the first ones to admit that our build system is convenient, but not
completely &#8216;push button&#8217; for all platforms. For machines at LLNL, there are
a few platform-specific things you must do to make things work. We note
them here. As things improve, we will update the information here.</p>
<blockquote>
<div><ul>
<li><p class="first">BG/Q builds</p>
<p>So far, at LLNL, we have only been able to build our complete set of
RAJA tests and examples on BG/Q using the GNU compiler. We have had
moderate success with the clang compiler. To build with the GNU compiler,
you need to set the version of python and CMake. You can do this by
typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ use cmake-3.1.2
$ use python-2.7.3
</pre></div>
</div>
<p>After this, you can use the &#8216;config-build.py&#8217; script as usual.</p>
</li>
<li><p class="first">nvcc builds</p>
<p>To compile with &#8216;nvcc&#8217; on LC machines that have GPUs that support CUDA,
you will have to load the CUDA module and set the host compiler. For
example, type these lines</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ module load cudatoolkit/7.5
$ use gcc-4.9.3p
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="raja-configuration-options">
<h2>RAJA configuration options<a class="headerlink" href="#raja-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>The RAJA include directory &#8216;include/RAJA&#8217; contains a header file
called &#8216;config.hxx.in&#8217; that is used to centralize all the configuration
options that RAJA supports in one location. Most RAJA constructs are
parametrized to make it easy to try alternative implementation choices.</p>
<p>The items in the configuration header file are set when the code is
configured. The results appear in the &#8216;config.hxx&#8217; file which lives in
the &#8216;include/RAJA&#8217; directory in the build space. This file gets pulled into
all other RAJA header files so everything is consistent. The settings are
controlled by the contents of the selected host configuration
file and the top-level RAJA &#8216;CMakeLists.txt file&#8217;. For example, the file
associated with the Intel compiler on LLNL Linux platforms is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">RAJA_COMPILER</span> <span class="s2">&quot;RAJA_COMPILER_ICC&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_C_COMPILER</span> <span class="s2">&quot;/usr/local/bin/icc-16.0.109&quot;</span> <span class="n">CACHE</span> <span class="n">PATH</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_COMPILER</span> <span class="s2">&quot;/usr/local/bin/icpc-16.0.109&quot;</span> <span class="n">CACHE</span> <span class="n">PATH</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">CMAKE_BUILD_TYPE</span> <span class="n">MATCHES</span> <span class="n">Release</span><span class="p">)</span>
  <span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_FLAGS</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_CXX_FLAGS}</span><span class="s2"> -O3 -mavx -inline-max-total-size=20000 -inline-forceinline -ansi-alias -std=c++0x&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">elseif</span><span class="p">(</span><span class="n">CMAKE_BUILD_TYPE</span> <span class="n">MATCHES</span> <span class="n">RelWithDebInfo</span><span class="p">)</span>
  <span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_FLAGS</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_CXX_FLAGS}</span><span class="s2"> -O3 -mavx -inline-max-total-size=20000 -inline-forceinline -ansi-alias -std=c++0x&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">elseif</span><span class="p">(</span><span class="n">CMAKE_BUILD_TYPE</span> <span class="n">MATCHES</span> <span class="n">Debug</span><span class="p">)</span>
  <span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_FLAGS</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_CXX_FLAGS}</span><span class="s2"> -O0 -std=c++0x&quot;</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_USE_OPENMP</span> <span class="n">On</span> <span class="n">CACHE</span> <span class="n">BOOL</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_USE_CILK</span> <span class="n">On</span> <span class="n">CACHE</span> <span class="n">BOOL</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_RANGE_ALIGN</span> <span class="mi">4</span> <span class="n">CACHE</span> <span class="n">INT</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_RANGE_MIN_LENGTH</span> <span class="mi">32</span> <span class="n">CACHE</span> <span class="n">INT</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_DATA_ALIGN</span> <span class="mi">64</span> <span class="n">CACHE</span> <span class="n">INT</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">RAJA_COHERENCE_BLOCK_SIZE</span> <span class="mi">64</span> <span class="n">CACHE</span> <span class="n">INT</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first line sets a RAJA compiler variable that is used to control
compiler-specific syntax for certain RAJA features. The next several
commands in the file set the compiler and options for each build type.
Next, programming model options, such as OpenMP, CilkPlus, CUDA, etc. are
turned on or off. For example, the Intel compiler supports both OpenMP and
CilkPlus; so those are turned on here. Finally, options for data alignment,
index set range segments, and other things are set.</p>
<p>The CMakeLists.txt file in the top-level RAJA directory controls settings
for other items that are not specific to a compiler. In that file, you will
find variables to set RAJA options for:</p>
<blockquote>
<div><ul class="simple">
<li>Floating-point type (e.g., double or float)</li>
<li>Pointer types (e.g., bare ptr, ptr with restrict, ptr classes, etc.)</li>
<li>Loop-level fault tolerance options</li>
<li>Timer options for examples</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring and building the code</a><ul>
<li><a class="reference internal" href="#raja-cmake-system">RAJA CMake System</a></li>
<li><a class="reference internal" href="#raja-configuration-options">RAJA configuration options</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="why_raja.html"
                        title="previous chapter">Why RAJA?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="code_organization.html"
                        title="next chapter">RAJA source code organization</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/config_build.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="code_organization.html" title="RAJA source code organization"
             >next</a> |</li>
        <li class="right" >
          <a href="why_raja.html" title="Why RAJA?"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RAJA 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Rich Hornung and Jeff Keasler.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>